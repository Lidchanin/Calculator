<?xml version="1.0" encoding="utf-8" ?>
<pages:BasePage xmlns="http://xamarin.com/schemas/2014/forms"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                xmlns:enums="clr-namespace:Calculator.Enums;assembly=Calculator"
                xmlns:helpers="clr-namespace:Calculator.Helpers;assembly=Calculator"
                xmlns:pages="clr-namespace:Calculator.Pages;assembly=Calculator"
                xmlns:viewModels="clr-namespace:Calculator.ViewModels;assembly=Calculator"
                xmlns:tinted="clr-namespace:Plugin.CrossPlatformTintedImage.Abstractions;assembly=Plugin.CrossPlatformTintedImage.Abstractions"
                x:Class="Calculator.Pages.CalculatorPage"
                NavigationPage.HasBackButton="True"
                Title="Calculator">

    <NavigationPage.TitleView>
        <Grid ColumnSpacing="0" 
              RowSpacing="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <tinted:TintedImage x:Name="HistoryButton"
                                Source="{x:Static helpers:ConstantHelper.HistoryIcon}"
                                TintColor="{DynamicResource NavBarItemsColor}"
                                HeightRequest="24"
                                WidthRequest="24"
                                Grid.Column="1">
                <tinted:TintedImage.GestureRecognizers>
                    <TapGestureRecognizer Tapped="HistoryButton_OnTapped"
                                          NumberOfTapsRequired="1"/>
                </tinted:TintedImage.GestureRecognizers>
            </tinted:TintedImage>

            <tinted:TintedImage x:Name="ThemesButton" 
                                Source="{x:Static helpers:ConstantHelper.PaletteIcon}"
                                TintColor="{DynamicResource NavBarItemsColor}"
                                HeightRequest="24"
                                WidthRequest="24"
                                Margin="10,0"
                                Grid.Column="2">
                <tinted:TintedImage.GestureRecognizers>
                    <TapGestureRecognizer Tapped="ThemesButton_OnTapped" 
                                          NumberOfTapsRequired="1"/>
                </tinted:TintedImage.GestureRecognizers>
            </tinted:TintedImage>
        </Grid>
    </NavigationPage.TitleView>

    <pages:BasePage.BindingContext>
        <viewModels:CalculatorViewModel x:Name="ViewModel"/>
    </pages:BasePage.BindingContext>

    <pages:BasePage.Resources>
        <ResourceDictionary>
            <Style x:Key="BaseLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="Large"/>
                <Setter Property="HorizontalTextAlignment" Value="End"/>
                <Setter Property="VerticalTextAlignment" Value="Center"/>
                <Setter Property="LineBreakMode" Value="NoWrap"/>
            </Style>

            <Style x:Key="BaseButtonStyle" TargetType="Button">
                <Setter Property="FontSize" Value="Large"/>
                <Setter Property="BackgroundColor" Value="Transparent"/>
                <Setter Property="TextColor" Value="{DynamicResource SecondaryTextColor}"/>
                <Setter Property="Command" Value="{Binding ButtonPressCommand}"/>
            </Style>

            <Style x:Key="NumbersSectionButtonStyle" TargetType="Button"
                   BasedOn="{StaticResource BaseButtonStyle}">
            </Style>

            <Style x:Key="OperationsSectionButtonStyle" TargetType="Button"
                   BasedOn="{StaticResource BaseButtonStyle}">
            </Style>

            <Style x:Key="BaseGridStyle" TargetType="Grid">
                <Setter Property="ColumnSpacing" Value="0"/>
                <Setter Property="RowSpacing" Value="0"/>
            </Style>
        </ResourceDictionary>
    </pages:BasePage.Resources>

    <pages:BasePage.Content>
        <Grid Style="{StaticResource BaseGridStyle}"
              BackgroundColor="{DynamicResource PrimaryBackgroundColor}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="1*"/>
                <RowDefinition Height="1*"/>
                <RowDefinition Height="4*"/>
            </Grid.RowDefinitions>

            <!--#region Expression and Result section-->
            <ScrollView Orientation="Horizontal" 
                        Padding="10,0"
                        HorizontalScrollBarVisibility="Never"
                        Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Grid.Row="0">
                <FlexLayout Direction="Row"
                            AlignItems="Center"
                            JustifyContent="End">
                    <Label Text="{Binding ExpressionString}"
                           Style="{StaticResource BaseLabelStyle}"
                           TextColor="{DynamicResource PrimaryTextColor}"/>
                </FlexLayout>
            </ScrollView>

            <ScrollView Orientation="Horizontal"
                        Padding="10,0"
                        HorizontalScrollBarVisibility="Never"
                        Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Grid.Row="1">
                <StackLayout HorizontalOptions="EndAndExpand"
                             VerticalOptions="CenterAndExpand">
                    <Label Text="{Binding ResultString}"
                           Style="{StaticResource BaseLabelStyle}"
                           TextColor="{DynamicResource PrimaryTextColor}"/>
                </StackLayout>
            </ScrollView>
            <!--#endregion Expression and Result section-->

            <!--#region Numbers section-->
            <Grid Style="{StaticResource BaseGridStyle}" 
                  BackgroundColor="{DynamicResource SecondaryBackgroundColor}"
                  Grid.Column="0"
                  Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="1*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="1*"/>
                </Grid.RowDefinitions>

                <Button Text="{x:Static helpers:ConstantHelper.SevenButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Seven}"
                        Grid.Column="0"
                        Grid.Row="0"/>
                <Button Text="{x:Static helpers:ConstantHelper.FourButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Four}"
                        Grid.Column="0"
                        Grid.Row="1"/>
                <Button Text="{x:Static helpers:ConstantHelper.OneButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.One}"
                        Grid.Column="0"
                        Grid.Row="2"/>
                <Button Text="{x:Static helpers:ConstantHelper.PointButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Point}"
                        Grid.Column="0"
                        Grid.Row="3"/>
                <Button Text="{x:Static helpers:ConstantHelper.EightButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Eight}"
                        Grid.Column="1"
                        Grid.Row="0"/>
                <Button Text="{x:Static helpers:ConstantHelper.FiveButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Five}"
                        Grid.Column="1"
                        Grid.Row="1"/>
                <Button Text="{x:Static helpers:ConstantHelper.TwoButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Two}"
                        Grid.Column="1"
                        Grid.Row="2"/>
                <Button Text="{x:Static helpers:ConstantHelper.ZeroButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Zero}"
                        Grid.Column="1"
                        Grid.Row="3"/>
                <Button Text="{x:Static helpers:ConstantHelper.NineButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Nine}"
                        Grid.Column="2"
                        Grid.Row="0"/>
                <Button Text="{x:Static helpers:ConstantHelper.SixButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Six}"
                        Grid.Column="2"
                        Grid.Row="1"/>
                <Button Text="{x:Static helpers:ConstantHelper.ThreeButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Three}"
                        Grid.Column="2"
                        Grid.Row="2"/>
                <Button Text="{x:Static helpers:ConstantHelper.EqualButtonText}"
                        Style="{StaticResource NumbersSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Equal}"
                        Grid.Column="2"
                        Grid.Row="3"/>
            </Grid>
            <!--#endregion Numbers section-->

            <!--#region Operations section-->
            <Grid Style="{StaticResource BaseGridStyle}" 
                  BackgroundColor="{DynamicResource TertiaryBackgroundColor}"
                  Grid.Column="1"
                  Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="1*"/>
                </Grid.RowDefinitions>

                <Button Text="{x:Static helpers:ConstantHelper.ClearButtonText}"
                        Style="{StaticResource OperationsSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.ClearEntry}"
                        Pressed="ClearButton_OnPressed"
                        Grid.Row="0"/>
                <Button Text="{x:Static helpers:ConstantHelper.DivideButtonText}"
                        Style="{StaticResource OperationsSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Divide}"
                        Grid.Row="1"/>
                <Button Text="{x:Static helpers:ConstantHelper.MultiplyButtonText}"
                        Style="{StaticResource OperationsSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Multiply}"
                        Grid.Row="2"/>
                <Button Text="{x:Static helpers:ConstantHelper.MinusButtonText}"
                        Style="{StaticResource OperationsSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Minus}"
                        Grid.Row="3"/>
                <Button Text="{x:Static helpers:ConstantHelper.PlusButtonText}"
                        Style="{StaticResource OperationsSectionButtonStyle}"
                        CommandParameter="{x:Static enums:CalculatorKeys.Plus}"
                        Grid.Row="4"/>
            </Grid>
            <!--#endregion Operations section-->
        </Grid>
    </pages:BasePage.Content>
</pages:BasePage>
